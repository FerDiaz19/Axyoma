=========================================================
CORRECCIÓN: FILTRADO DE PLANTAS POR EMPRESA
=========================================================

❌ PROBLEMAS IDENTIFICADOS:

1. **Plantas por defecto en empresas nuevas:**
   - Las empresas recién registradas mostraban plantas de otras empresas
   - Causa: Faltaba filtrado por empresa en PlantaViewSet

2. **Plantas creadas no aparecían:**
   - Las plantas creadas no se mostraban en la estructura  
   - Causa: El mismo problema de filtrado

✅ SOLUCIÓN APLICADA:

Agregado método `get_queryset()` al PlantaViewSet para filtrar plantas:

```python
def get_queryset(self):
    # Filtrar plantas por empresa del usuario logueado
    user = self.request.user
    if hasattr(user, 'perfil'):
        if user.perfil.nivel_usuario == 'admin-empresa':
            try:
                empresa = Empresa.objects.get(administrador=user.perfil)
                return Planta.objects.filter(empresa=empresa, status=True)
            except Empresa.DoesNotExist:
                return Planta.objects.none()
        elif user.perfil.nivel_usuario == 'superadmin':
            # Superadmin puede ver todas las plantas
            return Planta.objects.filter(status=True)
        elif user.perfil.nivel_usuario == 'admin-planta':
            # Admin de planta solo ve sus plantas asignadas
            from apps.users.models import AdminPlanta
            admin_plantas = AdminPlanta.objects.filter(usuario=user.perfil)
            plantas_ids = [ap.planta.planta_id for ap in admin_plantas]
            return Planta.objects.filter(planta_id__in=plantas_ids, status=True)
    
    return Planta.objects.none()
```

=========================================================
COMPORTAMIENTO CORREGIDO:

✅ **Admin-Empresa:**
- Solo ve plantas de SU empresa
- Empresas nuevas ven 0 plantas (correcto)
- Plantas creadas aparecen inmediatamente

✅ **Admin-Planta:**  
- Solo ve plantas que tiene asignadas
- Filtrado por AdminPlanta

✅ **Superadmin:**
- Ve todas las plantas del sistema
- Sin filtrado por empresa

=========================================================
PRUEBAS REALIZADAS:

📊 **Estado actual de empresas:**
- CodeWave Solutions: 4 plantas
- Empresa Test Registro: 0 plantas ✅
- axis: 1 planta  
- Empresa Test Limpia: 0 plantas ✅

🧪 **Scripts de prueba:**
- debug_empresas_plantas.py -> Verificar plantas por empresa
- test_filtrado_plantas.py -> Probar API con filtrado

=========================================================
CÓMO VERIFICAR LA CORRECCIÓN:

1. **Registrar nueva empresa:**
   - Debería mostrar 0 plantas inicialmente ✅

2. **Crear plantas:**
   - Deberían aparecer inmediatamente en la lista ✅
   - Solo las de la empresa del usuario ✅

3. **Login con diferentes empresas:**
   - Cada una solo ve sus plantas ✅

=========================================================
ARCHIVOS MODIFICADOS:
- Backend/apps/views.py -> Agregado get_queryset() en PlantaViewSet

FUNCIONALIDAD RESTAURADA:
✅ Filtrado correcto de plantas por empresa
✅ Empresas nuevas sin plantas por defecto  
✅ Plantas creadas aparecen inmediatamente
✅ Límite de 5 plantas por empresa
✅ Usuarios automáticos de planta
✅ Sección para ver usuarios de planta

=========================================================
