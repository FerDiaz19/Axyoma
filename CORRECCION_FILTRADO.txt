=========================================================
CORRECCIÃ“N: FILTRADO DE PLANTAS POR EMPRESA
=========================================================

âŒ PROBLEMAS IDENTIFICADOS:

1. **Plantas por defecto en empresas nuevas:**
   - Las empresas reciÃ©n registradas mostraban plantas de otras empresas
   - Causa: Faltaba filtrado por empresa en PlantaViewSet

2. **Plantas creadas no aparecÃ­an:**
   - Las plantas creadas no se mostraban en la estructura  
   - Causa: El mismo problema de filtrado

âœ… SOLUCIÃ“N APLICADA:

Agregado mÃ©todo `get_queryset()` al PlantaViewSet para filtrar plantas:

```python
def get_queryset(self):
    # Filtrar plantas por empresa del usuario logueado
    user = self.request.user
    if hasattr(user, 'perfil'):
        if user.perfil.nivel_usuario == 'admin-empresa':
            try:
                empresa = Empresa.objects.get(administrador=user.perfil)
                return Planta.objects.filter(empresa=empresa, status=True)
            except Empresa.DoesNotExist:
                return Planta.objects.none()
        elif user.perfil.nivel_usuario == 'superadmin':
            # Superadmin puede ver todas las plantas
            return Planta.objects.filter(status=True)
        elif user.perfil.nivel_usuario == 'admin-planta':
            # Admin de planta solo ve sus plantas asignadas
            from apps.users.models import AdminPlanta
            admin_plantas = AdminPlanta.objects.filter(usuario=user.perfil)
            plantas_ids = [ap.planta.planta_id for ap in admin_plantas]
            return Planta.objects.filter(planta_id__in=plantas_ids, status=True)
    
    return Planta.objects.none()
```

=========================================================
COMPORTAMIENTO CORREGIDO:

âœ… **Admin-Empresa:**
- Solo ve plantas de SU empresa
- Empresas nuevas ven 0 plantas (correcto)
- Plantas creadas aparecen inmediatamente

âœ… **Admin-Planta:**  
- Solo ve plantas que tiene asignadas
- Filtrado por AdminPlanta

âœ… **Superadmin:**
- Ve todas las plantas del sistema
- Sin filtrado por empresa

=========================================================
PRUEBAS REALIZADAS:

ðŸ“Š **Estado actual de empresas:**
- CodeWave Solutions: 4 plantas
- Empresa Test Registro: 0 plantas âœ…
- axis: 1 planta  
- Empresa Test Limpia: 0 plantas âœ…

ðŸ§ª **Scripts de prueba:**
- debug_empresas_plantas.py -> Verificar plantas por empresa
- test_filtrado_plantas.py -> Probar API con filtrado

=========================================================
CÃ“MO VERIFICAR LA CORRECCIÃ“N:

1. **Registrar nueva empresa:**
   - DeberÃ­a mostrar 0 plantas inicialmente âœ…

2. **Crear plantas:**
   - DeberÃ­an aparecer inmediatamente en la lista âœ…
   - Solo las de la empresa del usuario âœ…

3. **Login con diferentes empresas:**
   - Cada una solo ve sus plantas âœ…

=========================================================
ARCHIVOS MODIFICADOS:
- Backend/apps/views.py -> Agregado get_queryset() en PlantaViewSet

FUNCIONALIDAD RESTAURADA:
âœ… Filtrado correcto de plantas por empresa
âœ… Empresas nuevas sin plantas por defecto  
âœ… Plantas creadas aparecen inmediatamente
âœ… LÃ­mite de 5 plantas por empresa
âœ… Usuarios automÃ¡ticos de planta
âœ… SecciÃ³n para ver usuarios de planta

=========================================================
